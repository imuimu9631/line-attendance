<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†ç”»é¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .clock {
            font-size: 18px;
            opacity: 0.9;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 250px;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        .menu-item {
            padding: 12px 16px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #555;
        }

        .menu-item:hover {
            background: #f0f2f5;
            color: #667eea;
        }

        .menu-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* ã‚«ãƒ¼ãƒ‰ */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f2f5;
        }

        .card h2 {
            color: #333;
            font-size: 20px;
        }

        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid #667eea;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ  */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* ãƒãƒƒã‚¸ */
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* QRã‚³ãƒ¼ãƒ‰ */
        .qr-container {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        #qrcode {
            display: inline-block;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 12px;
            padding: 30px;
            position: relative;
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f2f5;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        /* ã‚¿ãƒ– */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* æ¤œç´¢ãƒãƒ¼ */
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        /* ãƒãƒƒãƒ— */
        .chip {
            display: inline-block;
            padding: 6px 12px;
            background: #e9ecef;
            border-radius: 20px;
            font-size: 12px;
            margin: 2px;
        }

        /* æœ‰çµ¦æ®‹æ—¥æ•°ã®è‰²åˆ†ã‘ */
        .vacation-high { color: #28a745; }
        .vacation-medium { color: #ffc107; }
        .vacation-low { color: #dc3545; }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .menu-item {
                white-space: nowrap;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>ğŸ± å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†ç”»é¢</h1>
            <div class="clock" id="clock"></div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="menu-item active" onclick="showSection('dashboard')">
                ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
            </div>
            <div class="menu-item" onclick="showSection('employees')">
                ğŸ‘¥ å¾“æ¥­å“¡ç®¡ç†
            </div>
            <div class="menu-item" onclick="showSection('attendance')">
                â° å‹¤æ€ è¨˜éŒ²
            </div>
            <div class="menu-item" onclick="showSection('salary')">
                ğŸ’° çµ¦ä¸ãƒ»äº¤é€šè²»
            </div>
            <div class="menu-item" onclick="showSection('vacation')">
                ğŸ–ï¸ æœ‰çµ¦ç®¡ç†
            </div>
            <div class="menu-item" onclick="showSection('qr')">
                ğŸ“± QRã‚³ãƒ¼ãƒ‰
            </div>
            <div class="menu-item" onclick="showSection('reports')">
                ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆ
            </div>
            <div class="menu-item" onclick="showSection('settings')">
                âš™ï¸ è¨­å®š
            </div>
        </div>

        <div class="main-content">
            <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
            <div id="dashboard" class="content-section active">
                <h2 style="margin-bottom: 30px;">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æœ¬æ—¥ã®å‡ºå‹¤è€…</h3>
                        <div class="stat-value" id="todayAttendance">0</div>
                        <div class="stat-label">å</div>
                    </div>
                    <div class="stat-card">
                        <h3>ç¾åœ¨å‹¤å‹™ä¸­</h3>
                        <div class="stat-value" id="currentlyWorking">0</div>
                        <div class="stat-label">å</div>
                    </div>
                    <div class="stat-card">
                        <h3>ä»Šæœˆã®å‹¤å‹™æ™‚é–“</h3>
                        <div class="stat-value" id="monthlyHours">0</div>
                        <div class="stat-label">æ™‚é–“</div>
                    </div>
                    <div class="stat-card">
                        <h3>ä»Šæœˆã®äººä»¶è²»</h3>
                        <div class="stat-value" id="monthlyCost">0</div>
                        <div class="stat-label">å††</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>æœ¬æ—¥ã®å‹¤æ€ çŠ¶æ³</h2>
                        <button class="btn btn-primary" onclick="refreshDashboard()">æ›´æ–°</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡</th>
                                <th>å‡ºå‹¤æ™‚åˆ»</th>
                                <th>é€€å‹¤æ™‚åˆ»</th>
                                <th>å‹¤å‹™æ™‚é–“</th>
                                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            </tr>
                        </thead>
                        <tbody id="todayAttendanceTable">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>æœ‰çµ¦å–å¾—äºˆå®š</h2>
                    </div>
                    <div id="upcomingVacations">
                        <p style="color: #999;">äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                </div>
            </div>

            <!-- å¾“æ¥­å“¡ç®¡ç† -->
            <div id="employees" class="content-section">
                <h2 style="margin-bottom: 30px;">ğŸ‘¥ å¾“æ¥­å“¡ç®¡ç†</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h2>å¾“æ¥­å“¡ç™»éŒ²</h2>
                    </div>
                    <form id="employeeForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¾“æ¥­å“¡ã‚³ãƒ¼ãƒ‰</label>
                                <input type="text" class="form-control" id="empCode" placeholder="EMP001" required>
                            </div>
                            <div class="form-group">
                                <label>æ°å</label>
                                <input type="text" class="form-control" id="empName" placeholder="å±±ç”°å¤ªéƒ" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                <input type="email" class="form-control" id="empEmail" placeholder="yamada@example.com">
                            </div>
                            <div class="form-group">
                                <label>é›»è©±ç•ªå·</label>
                                <input type="tel" class="form-control" id="empPhone" placeholder="090-1234-5678">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>æ™‚çµ¦ï¼ˆå††ï¼‰</label>
                                <input type="number" class="form-control" id="empHourlyRate" placeholder="1200" min="0">
                            </div>
                            <div class="form-group">
                                <label>äº¤é€šè²»ï¼ˆæ—¥é¡ãƒ»å††ï¼‰</label>
                                <input type="number" class="form-control" id="empTransportation" placeholder="500" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>æœ‰çµ¦ä»˜ä¸æ—¥æ•°ï¼ˆå¹´é–“ï¼‰</label>
                                <input type="number" class="form-control" id="empVacationDays" placeholder="10" min="0">
                            </div>
                            <div class="form-group">
                                <label>å…¥ç¤¾æ—¥</label>
                                <input type="date" class="form-control" id="empJoinDate" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">å¾“æ¥­å“¡ã‚’ç™»éŒ²</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>å¾“æ¥­å“¡ä¸€è¦§</h2>
                        <div class="action-buttons">
                            <button class="btn btn-info" onclick="exportEmployees()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                            <button class="btn btn-warning" onclick="importEmployees()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                        </div>
                    </div>
                    <div class="search-bar">
                        <input type="text" class="search-input" id="employeeSearch" placeholder="åå‰ã¾ãŸã¯å¾“æ¥­å“¡ã‚³ãƒ¼ãƒ‰ã§æ¤œç´¢" onkeyup="searchEmployees()">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡ã‚³ãƒ¼ãƒ‰</th>
                                <th>æ°å</th>
                                <th>æ™‚çµ¦</th>
                                <th>äº¤é€šè²»</th>
                                <th>æœ‰çµ¦æ®‹</th>
                                <th>å…¥ç¤¾æ—¥</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTable">
                            <tr>
                                <td colspan="7" style="text-align: center; color: #999;">å¾“æ¥­å“¡ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- å‹¤æ€ è¨˜éŒ² -->
            <div id="attendance" class="content-section">
                <h2 style="margin-bottom: 30px;">â° å‹¤æ€ è¨˜éŒ²</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h2>å‹¤æ€ è¨˜éŒ²æ¤œç´¢</h2>
                    </div>
                    <div class="search-bar">
                        <input type="date" class="form-control" id="attendanceStartDate">
                        <input type="date" class="form-control" id="attendanceEndDate">
                        <select class="form-control" id="attendanceEmployee">
                            <option value="">å…¨å¾“æ¥­å“¡</option>
                        </select>
                        <button class="btn btn-primary" onclick="searchAttendance()">æ¤œç´¢</button>
                        <button class="btn btn-info" onclick="exportAttendance()">CSVå‡ºåŠ›</button>
                    </div>
                </div>

                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>æ—¥ä»˜</th>
                                <th>å¾“æ¥­å“¡</th>
                                <th>å‡ºå‹¤</th>
                                <th>é€€å‹¤</th>
                                <th>ä¼‘æ†©</th>
                                <th>å‹¤å‹™æ™‚é–“</th>
                                <th>æ®‹æ¥­æ™‚é–“</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTable">
                            <tr>
                                <td colspan="8" style="text-align: center; color: #999;">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- çµ¦ä¸ãƒ»äº¤é€šè²» -->
            <div id="salary" class="content-section">
                <h2 style="margin-bottom: 30px;">ğŸ’° çµ¦ä¸ãƒ»äº¤é€šè²»ç®¡ç†</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h2>æœˆæ¬¡çµ¦ä¸è¨ˆç®—</h2>
                    </div>
                    <div class="form-row">
                        <select class="form-control" id="salaryMonth">
                            <option value="">å¯¾è±¡æœˆã‚’é¸æŠ</option>
                        </select>
                        <button class="btn btn-primary" onclick="calculateSalary()">è¨ˆç®—å®Ÿè¡Œ</button>
                    </div>
                </div>

                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡</th>
                                <th>å‹¤å‹™æ—¥æ•°</th>
                                <th>å‹¤å‹™æ™‚é–“</th>
                                <th>åŸºæœ¬çµ¦</th>
                                <th>æ®‹æ¥­ä»£</th>
                                <th>äº¤é€šè²»</th>
                                <th>ç·æ”¯çµ¦é¡</th>
                                <th>è©³ç´°</th>
                            </tr>
                        </thead>
                        <tbody id="salaryTable">
                            <tr>
                                <td colspan="8" style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-success" onclick="exportSalarySlip()">çµ¦ä¸æ˜ç´°å‡ºåŠ›</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>æ™‚çµ¦ãƒ»äº¤é€šè²»è¨­å®š</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡</th>
                                <th>ç¾åœ¨ã®æ™‚çµ¦</th>
                                <th>æ–°æ™‚çµ¦</th>
                                <th>äº¤é€šè²»ï¼ˆæ—¥é¡ï¼‰</th>
                                <th>é©ç”¨æ—¥</th>
                                <th>æ›´æ–°</th>
                            </tr>
                        </thead>
                        <tbody id="salarySettingTable">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- æœ‰çµ¦ç®¡ç† -->
            <div id="vacation" class="content-section">
                <h2 style="margin-bottom: 30px;">ğŸ–ï¸ æœ‰çµ¦ç®¡ç†</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>ç·ä»˜ä¸æ—¥æ•°</h3>
                        <div class="stat-value" id="totalVacationDays">0</div>
                        <div class="stat-label">æ—¥</div>
                    </div>
                    <div class="stat-card">
                        <h3>ç·å–å¾—æ—¥æ•°</h3>
                        <div class="stat-value" id="usedVacationDays">0</div>
                        <div class="stat-label">æ—¥</div>
                    </div>
                    <div class="stat-card">
                        <h3>å–å¾—ç‡</h3>
                        <div class="stat-value" id="vacationRate">0</div>
                        <div class="stat-label">%</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>æœ‰çµ¦ç”³è«‹</h2>
                    </div>
                    <form id="vacationForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¾“æ¥­å“¡</label>
                                <select class="form-control" id="vacationEmployee" required>
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ç¨®åˆ¥</label>
                                <select class="form-control" id="vacationType" required>
                                    <option value="full">å…¨æ—¥</option>
                                    <option value="morning">åˆå‰åŠä¼‘</option>
                                    <option value="afternoon">åˆå¾ŒåŠä¼‘</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å–å¾—æ—¥</label>
                                <input type="date" class="form-control" id="vacationDate" required>
                            </div>
                            <div class="form-group">
                                <label>ç†ç”±</label>
                                <input type="text" class="form-control" id="vacationReason" placeholder="ç§ç”¨ã®ãŸã‚">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">ç”³è«‹ç™»éŒ²</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>æœ‰çµ¦æ®‹æ—¥æ•°ä¸€è¦§</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡</th>
                                <th>ä»˜ä¸æ—¥æ•°</th>
                                <th>å–å¾—æ¸ˆ</th>
                                <th>æ®‹æ—¥æ•°</th>
                                <th>æ¬¡å›ä»˜ä¸æ—¥</th>
                                <th>è©³ç´°</th>
                            </tr>
                        </thead>
                        <tbody id="vacationTable">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>æœ‰çµ¦å–å¾—å±¥æ­´</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ç”³è«‹æ—¥</th>
                                <th>å¾“æ¥­å“¡</th>
                                <th>å–å¾—æ—¥</th>
                                <th>ç¨®åˆ¥</th>
                                <th>ç†ç”±</th>
                                <th>æ‰¿èªçŠ¶æ³</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="vacationHistoryTable">
                            <tr>
                                <td colspan="7" style="text-align: center; color: #999;">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- QRã‚³ãƒ¼ãƒ‰ -->
            <div id="qr" class="content-section">
                <h2 style="margin-bottom: 30px;">ğŸ“± QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h2>æ‰“åˆ»ç”¨QRã‚³ãƒ¼ãƒ‰</h2>
                        <div class="action-buttons">
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoRefreshQR" checked onchange="toggleAutoRefresh()">
                                <span class="slider"></span>
                            </label>
                            <span style="margin-left: 10px;">è‡ªå‹•æ›´æ–°ï¼ˆ60ç§’ã”ã¨ï¼‰</span>
                        </div>
                    </div>
                    <div class="tabs">
                        <div class="tab active" onclick="selectQRType('in')">å‡ºå‹¤ç”¨</div>
                        <div class="tab" onclick="selectQRType('out')">é€€å‹¤ç”¨</div>
                        <div class="tab" onclick="selectQRType('break-start')">ä¼‘æ†©é–‹å§‹ç”¨</div>
                        <div class="tab" onclick="selectQRType('break-end')">ä¼‘æ†©çµ‚äº†ç”¨</div>
                    </div>
                    <div class="qr-container">
                        <div id="qrcode"></div>
                        <div style="margin-top: 20px;">
                            <p id="qrType" style="font-size: 18px; font-weight: bold; color: #667eea;">å‡ºå‹¤ç”¨QRã‚³ãƒ¼ãƒ‰</p>
                            <p style="color: #666; margin-top: 10px;">æœ‰åŠ¹æœŸé™: <span id="qrExpiry">-</span></p>
                            <p style="color: #999; margin-top: 5px; font-size: 14px;">æ®‹ã‚Šæ™‚é–“: <span id="qrCountdown" style="color: #ff6b6b; font-weight: bold;">60ç§’</span></p>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="downloadQR()">ç”»åƒä¿å­˜</button>
                            <button class="btn btn-success" onclick="printQR()">å°åˆ·</button>
                            <button class="btn btn-warning" onclick="manualRefreshQR()">æ‰‹å‹•æ›´æ–°</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>LIFF URL</h2>
                    </div>
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <p style="margin-bottom: 10px;">å¾“æ¥­å“¡ç”¨LINEã‚¢ãƒ—ãƒªURL:</p>
                        <input type="text" class="form-control" value="https://liff.line.me/2008444059-JmVGoO57" readonly>
                        <button class="btn btn-info" style="margin-top: 10px;" onclick="copyLiffUrl()">URLã‚’ã‚³ãƒ”ãƒ¼</button>
                    </div>
                </div>
            </div>

            <!-- ãƒ¬ãƒãƒ¼ãƒˆ -->
            <div id="reports" class="content-section">
                <h2 style="margin-bottom: 30px;">ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆ</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h2>æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h2>
                    </div>
                    <div class="form-row">
                        <select class="form-control" id="reportMonth">
                            <option value="">å¯¾è±¡æœˆã‚’é¸æŠ</option>
                        </select>
                        <select class="form-control" id="reportType">
                            <option value="attendance">å‹¤æ€ ãƒ¬ãƒãƒ¼ãƒˆ</option>
                            <option value="salary">çµ¦ä¸ãƒ¬ãƒãƒ¼ãƒˆ</option>
                            <option value="vacation">æœ‰çµ¦ãƒ¬ãƒãƒ¼ãƒˆ</option>
                            <option value="all">ç·åˆãƒ¬ãƒãƒ¼ãƒˆ</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateReport()">ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>åˆ†æã‚µãƒãƒªãƒ¼</h2>
                    </div>
                    <div id="reportSummary">
                        <p style="color: #999;">ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
            </div>

            <!-- è¨­å®š -->
            <div id="settings" class="content-section">
                <h2 style="margin-bottom: 30px;">âš™ï¸ è¨­å®š</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h2>åŸºæœ¬è¨­å®š</h2>
                    </div>
                    <div class="form-group">
                        <label>ä¼šç¤¾å</label>
                        <input type="text" class="form-control" id="companyName" placeholder="æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«">
                    </div>
                    <div class="form-group">
                        <label>æ‰€å®šåŠ´åƒæ™‚é–“ï¼ˆ1æ—¥ï¼‰</label>
                        <input type="number" class="form-control" id="workHours" value="8" min="1" max="24">
                    </div>
                    <div class="form-group">
                        <label>æ®‹æ¥­è¨ˆç®—é–‹å§‹æ™‚é–“</label>
                        <input type="number" class="form-control" id="overtimeThreshold" value="8" min="1" max="24">
                    </div>
                    <div class="form-group">
                        <label>æ·±å¤œå‰²å¢—ç‡ï¼ˆ%ï¼‰</label>
                        <input type="number" class="form-control" id="nightRate" value="25" min="0">
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">è¨­å®šã‚’ä¿å­˜</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="backupData()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ</button>
                        <button class="btn btn-warning" onclick="restoreData()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾©å…ƒ</button>
                        <button class="btn btn-danger" onclick="resetData()">ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¾“æ¥­å“¡ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('employeeModal')">&times;</span>
            <div class="modal-header">
                <h2>å¾“æ¥­å“¡æƒ…å ±ç·¨é›†</h2>
            </div>
            <form id="editEmployeeForm">
                <input type="hidden" id="editEmpId">
                <div class="form-group">
                    <label>å¾“æ¥­å“¡ã‚³ãƒ¼ãƒ‰</label>
                    <input type="text" class="form-control" id="editEmpCode" readonly>
                </div>
                <div class="form-group">
                    <label>æ°å</label>
                    <input type="text" class="form-control" id="editEmpName">
                </div>
                <div class="form-group">
                    <label>æ™‚çµ¦</label>
                    <input type="number" class="form-control" id="editEmpHourlyRate">
                </div>
                <div class="form-group">
                    <label>äº¤é€šè²»ï¼ˆæ—¥é¡ï¼‰</label>
                    <input type="number" class="form-control" id="editEmpTransportation">
                </div>
                <div class="form-group">
                    <label>æœ‰çµ¦ä»˜ä¸æ—¥æ•°</label>
                    <input type="number" class="form-control" id="editEmpVacationDays">
                </div>
                <button type="submit" class="btn btn-primary">æ›´æ–°</button>
            </form>
        </div>
    </div>

    <script>
        // ========================================
        // Google Sheets APIè¨­å®š
        // ========================================
        const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbyqpql1mobPxD_2qrnfSb7CobAKwjgjC-dD7ELLGNSBrOtw1LDpNJv7Ia3LekNtuv98/exec';
        
        // APIé€šä¿¡é–¢æ•°
        async function callGasApi(action, data = {}) {
            try {
                const response = await fetch(GAS_API_URL, {
                    method: 'POST',
                    mode: 'no-cors', // CORSå›é¿
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        ...data
                    })
                });
                
                // no-corsãƒ¢ãƒ¼ãƒ‰ã§ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒèª­ã‚ãªã„ãŸã‚ã€æˆåŠŸã¨ä»®å®š
                console.log(`APIå‘¼ã³å‡ºã—æˆåŠŸ: ${action}`);
                return { success: true };
            } catch (error) {
                console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
                return { success: false, error: error.message };
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿åŒæœŸé–¢æ•°
        async function syncToGoogleSheets(action, data) {
            if (!GAS_API_URL || GAS_API_URL === 'https://script.google.com/macros/s/AKfycbyqpql1mobPxD_2qrnfSb7CobAKwjgjC-dD7ELLGNSBrOtw1LDpNJv7Ia3LekNtuv98/exec') {
                console.warn('Google Sheets APIãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            return await callGasApi(action, data);
        }

        // ========================================
        // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‹Google Sheetsï¼‰
        // ========================================
        let employees = [];
        let attendanceRecords = [];
        let vacationRecords = [];
        let settings = {
            companyName: 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«',
            workHours: 8,
            overtimeThreshold: 8,
            nightRate: 25
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateClock();
            setInterval(updateClock, 1000);
            initializeMonthSelectors();
            generateQR('in');
            toggleAutoRefresh(); // è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹
            updateDashboard();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('employeeForm').addEventListener('submit', addEmployee);
            document.getElementById('vacationForm').addEventListener('submit', addVacation);
            document.getElementById('editEmployeeForm').addEventListener('submit', updateEmployee);
        });

        // æ™‚è¨ˆæ›´æ–°
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                weekday: 'long'
            });
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
        function showSection(sectionId) {
            // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // é¸æŠã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã®åˆæœŸåŒ–
            if (sectionId === 'employees') {
                loadEmployeeTable();
            } else if (sectionId === 'attendance') {
                loadAttendanceTable();
            } else if (sectionId === 'salary') {
                loadSalaryTable();
            } else if (sectionId === 'vacation') {
                loadVacationTable();
            }
        }

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadData() {
            employees = JSON.parse(localStorage.getItem('employees')) || [];
            attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || [];
            vacationRecords = JSON.parse(localStorage.getItem('vacationRecords')) || [];
            const savedSettings = localStorage.getItem('settings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            localStorage.setItem('employees', JSON.stringify(employees));
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            localStorage.setItem('vacationRecords', JSON.stringify(vacationRecords));
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        // å¾“æ¥­å“¡è¿½åŠ 
        async function addEmployee(e) {
            e.preventDefault();
            
            const employee = {
                id: Date.now(),
                code: document.getElementById('empCode').value,
                name: document.getElementById('empName').value,
                email: document.getElementById('empEmail').value,
                phone: document.getElementById('empPhone').value,
                hourlyRate: parseInt(document.getElementById('empHourlyRate').value) || 1200,
                transportation: parseInt(document.getElementById('empTransportation').value) || 0,
                vacationDays: parseInt(document.getElementById('empVacationDays').value) || 10,
                joinDate: document.getElementById('empJoinDate').value,
                createdAt: new Date().toISOString()
            };
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
            employees.push(employee);
            saveData();
            
            // Google Sheetsã«åŒæœŸ
            await syncToGoogleSheets('addEmployee', employee);
            
            alert(`${employee.name}ã•ã‚“ã‚’ç™»éŒ²ã—ã¾ã—ãŸ`);
            document.getElementById('employeeForm').reset();
            loadEmployeeTable();
        }

        // å¾“æ¥­å“¡ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
        function loadEmployeeTable() {
            const tbody = document.getElementById('employeeTable');
            
            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">å¾“æ¥­å“¡ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</td></tr>';
                return;
            }
            
            tbody.innerHTML = employees.map(emp => {
                const vacationUsed = getUsedVacationDays(emp.id);
                const vacationRemaining = emp.vacationDays - vacationUsed;
                const vacationClass = vacationRemaining >= 5 ? 'vacation-high' : vacationRemaining >= 2 ? 'vacation-medium' : 'vacation-low';
                
                return `
                    <tr>
                        <td>${emp.code}</td>
                        <td>${emp.name}</td>
                        <td>Â¥${emp.hourlyRate.toLocaleString()}</td>
                        <td>Â¥${emp.transportation.toLocaleString()}</td>
                        <td class="${vacationClass}">${vacationRemaining}æ—¥</td>
                        <td>${emp.joinDate}</td>
                        <td>
                            <button class="btn btn-info" onclick="editEmployee(${emp.id})">ç·¨é›†</button>
                            <button class="btn btn-danger" onclick="deleteEmployee(${emp.id})">å‰Šé™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // å¾“æ¥­å“¡ç·¨é›†
        function editEmployee(id) {
            const employee = employees.find(e => e.id === id);
            if (!employee) return;
            
            document.getElementById('editEmpId').value = employee.id;
            document.getElementById('editEmpCode').value = employee.code;
            document.getElementById('editEmpName').value = employee.name;
            document.getElementById('editEmpHourlyRate').value = employee.hourlyRate;
            document.getElementById('editEmpTransportation').value = employee.transportation;
            document.getElementById('editEmpVacationDays').value = employee.vacationDays;
            
            document.getElementById('employeeModal').style.display = 'block';
        }

        // å¾“æ¥­å“¡æ›´æ–°
        function updateEmployee(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editEmpId').value);
            const employee = employees.find(e => e.id === id);
            
            if (employee) {
                employee.name = document.getElementById('editEmpName').value;
                employee.hourlyRate = parseInt(document.getElementById('editEmpHourlyRate').value);
                employee.transportation = parseInt(document.getElementById('editEmpTransportation').value);
                employee.vacationDays = parseInt(document.getElementById('editEmpVacationDays').value);
                
                saveData();
                loadEmployeeTable();
                closeModal('employeeModal');
                alert('å¾“æ¥­å“¡æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
        }

        // å¾“æ¥­å“¡å‰Šé™¤
        function deleteEmployee(id) {
            if (confirm('ã“ã®å¾“æ¥­å“¡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                employees = employees.filter(e => e.id !== id);
                saveData();
                loadEmployeeTable();
            }
        }

        // QRã‚³ãƒ¼ãƒ‰é–¢é€£å¤‰æ•°
        let currentQRType = 'in';
        let qrAutoRefreshInterval = null;
        let qrCountdownInterval = null;
        let currentQRData = null;

        // QRã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—é¸æŠ
        function selectQRType(type) {
            currentQRType = type;
            
            // ã‚¿ãƒ–ã®é¸æŠçŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            generateQR(type);
        }

        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateQR(type) {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            // QRã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆLINE LIFFã§èª­ã¿å–ã‚Šå¯èƒ½ãªå½¢å¼ï¼‰
            const qrData = {
                action: 'attendance',
                type: type,
                timestamp: new Date().toISOString(),
                token: generateToken(),
                expiresIn: 60, // 60ç§’
                companyId: 'COMPANY001' // ä¼šç¤¾è­˜åˆ¥å­
            };
            
            currentQRData = qrData;
            
            // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
            new QRCode(qrContainer, {
                text: JSON.stringify(qrData),
                width: 256,
                height: 256,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // ã‚¿ã‚¤ãƒ—è¡¨ç¤ºæ›´æ–°
            const typeText = {
                'in': 'å‡ºå‹¤ç”¨QRã‚³ãƒ¼ãƒ‰',
                'out': 'é€€å‹¤ç”¨QRã‚³ãƒ¼ãƒ‰',
                'break-start': 'ä¼‘æ†©é–‹å§‹ç”¨QRã‚³ãƒ¼ãƒ‰',
                'break-end': 'ä¼‘æ†©çµ‚äº†ç”¨QRã‚³ãƒ¼ãƒ‰'
            };
            document.getElementById('qrType').textContent = typeText[type];
            
            // æœ‰åŠ¹æœŸé™è¡¨ç¤º
            const expiry = new Date();
            expiry.setSeconds(expiry.getSeconds() + 60);
            document.getElementById('qrExpiry').textContent = expiry.toLocaleTimeString('ja-JP');
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
            startQRCountdown(60);
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆLINEã‚¢ãƒ—ãƒªå´ã§æ¤œè¨¼ç”¨ï¼‰
            sessionStorage.setItem('qr_' + qrData.token, JSON.stringify(qrData));
        }

        // ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
        function generateToken() {
            return 'QR_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
        function startQRCountdown(seconds) {
            // æ—¢å­˜ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªã‚¢
            if (qrCountdownInterval) {
                clearInterval(qrCountdownInterval);
            }
            
            let remaining = seconds;
            const countdownElement = document.getElementById('qrCountdown');
            
            qrCountdownInterval = setInterval(() => {
                remaining--;
                
                if (remaining <= 0) {
                    clearInterval(qrCountdownInterval);
                    countdownElement.textContent = 'æœŸé™åˆ‡ã‚Œ';
                    countdownElement.style.color = '#dc3545';
                    
                    // è‡ªå‹•æ›´æ–°ãŒæœ‰åŠ¹ãªã‚‰æ–°ã—ã„QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                    if (document.getElementById('autoRefreshQR').checked) {
                        generateQR(currentQRType);
                    }
                } else {
                    countdownElement.textContent = remaining + 'ç§’';
                    
                    // æ®‹ã‚Šæ™‚é–“ã§è‰²ã‚’å¤‰ãˆã‚‹
                    if (remaining <= 10) {
                        countdownElement.style.color = '#dc3545';
                    } else if (remaining <= 30) {
                        countdownElement.style.color = '#ffc107';
                    } else {
                        countdownElement.style.color = '#28a745';
                    }
                }
            }, 1000);
        }

        // è‡ªå‹•æ›´æ–°ãƒˆã‚°ãƒ«
        function toggleAutoRefresh() {
            const autoRefresh = document.getElementById('autoRefreshQR').checked;
            
            if (autoRefresh) {
                // 60ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
                qrAutoRefreshInterval = setInterval(() => {
                    generateQR(currentQRType);
                }, 60000);
            } else {
                // è‡ªå‹•æ›´æ–°åœæ­¢
                if (qrAutoRefreshInterval) {
                    clearInterval(qrAutoRefreshInterval);
                    qrAutoRefreshInterval = null;
                }
            }
        }

        // æ‰‹å‹•æ›´æ–°
        function manualRefreshQR() {
            generateQR(currentQRType);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = attendanceRecords.filter(r => r.date === today);
            
            // çµ±è¨ˆæ›´æ–°
            document.getElementById('todayAttendance').textContent = todayRecords.filter(r => r.clockIn).length;
            document.getElementById('currentlyWorking').textContent = todayRecords.filter(r => r.clockIn && !r.clockOut).length;
            
            // ä»Šæœˆã®å‹¤å‹™æ™‚é–“ã¨äººä»¶è²»
            const thisMonth = new Date().toISOString().slice(0, 7);
            const monthlyRecords = attendanceRecords.filter(r => r.date.startsWith(thisMonth));
            
            let totalHours = 0;
            let totalCost = 0;
            
            monthlyRecords.forEach(record => {
                const employee = employees.find(e => e.code === record.employeeCode);
                if (employee && record.workHours) {
                    totalHours += record.workHours;
                    totalCost += record.workHours * employee.hourlyRate;
                    totalCost += employee.transportation;
                }
            });
            
            document.getElementById('monthlyHours').textContent = Math.round(totalHours);
            document.getElementById('monthlyCost').textContent = totalCost.toLocaleString();
            
            // æœ¬æ—¥ã®å‹¤æ€ ãƒ†ãƒ¼ãƒ–ãƒ«
            const tbody = document.getElementById('todayAttendanceTable');
            if (todayRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">æœ¬æ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>';
            } else {
                tbody.innerHTML = todayRecords.map(record => {
                    const employee = employees.find(e => e.code === record.employeeCode);
                    const status = record.clockOut ? '<span class="badge badge-success">é€€å‹¤æ¸ˆ</span>' : '<span class="badge badge-warning">å‹¤å‹™ä¸­</span>';
                    
                    return `
                        <tr>
                            <td>${employee ? employee.name : record.employeeCode}</td>
                            <td>${record.clockIn || '-'}</td>
                            <td>${record.clockOut || '-'}</td>
                            <td>${record.workHours ? record.workHours.toFixed(1) + 'æ™‚é–“' : '-'}</td>
                            <td>${status}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        // æœ‰çµ¦ä½¿ç”¨æ—¥æ•°å–å¾—
        function getUsedVacationDays(employeeId) {
            const currentYear = new Date().getFullYear();
            return vacationRecords.filter(v => {
                const vYear = new Date(v.date).getFullYear();
                return v.employeeId === employeeId && vYear === currentYear && v.status === 'approved';
            }).reduce((total, v) => {
                return total + (v.type === 'full' ? 1 : 0.5);
            }, 0);
        }

        // æœˆé¸æŠåˆæœŸåŒ–
        function initializeMonthSelectors() {
            const selectors = ['salaryMonth', 'reportMonth'];
            const now = new Date();
            
            selectors.forEach(selectorId => {
                const select = document.getElementById(selectorId);
                if (!select) return;
                
                for (let i = 0; i < 12; i++) {
                    const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const option = document.createElement('option');
                    option.value = date.toISOString().slice(0, 7);
                    option.textContent = date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' });
                    select.appendChild(option);
                }
            });
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // LIFF URLã‚³ãƒ”ãƒ¼
        function copyLiffUrl() {
            const url = 'https://liff.line.me/2008444059-JmVGoO57';
            navigator.clipboard.writeText(url);
            alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        }

        // ãã®ä»–ã®æ©Ÿèƒ½ã¯å¿…è¦ã«å¿œã˜ã¦å®Ÿè£…
        function refreshDashboard() { updateDashboard(); }
        function searchEmployees() { /* å®Ÿè£… */ }
        function searchAttendance() { /* å®Ÿè£… */ }
        function loadAttendanceTable() { /* å®Ÿè£… */ }
        function loadSalaryTable() { /* å®Ÿè£… */ }
        function loadVacationTable() { /* å®Ÿè£… */ }
        function calculateSalary() { /* å®Ÿè£… */ }
        function addVacation(e) { e.preventDefault(); /* å®Ÿè£… */ }
        function generateReport() { /* å®Ÿè£… */ }
        function saveSettings() { /* å®Ÿè£… */ }
        function backupData() { /* å®Ÿè£… */ }
        function restoreData() { /* å®Ÿè£… */ }
        function resetData() { /* å®Ÿè£… */ }
        function exportEmployees() { /* å®Ÿè£… */ }
        function importEmployees() { /* å®Ÿè£… */ }
        function exportAttendance() { /* å®Ÿè£… */ }
        function exportSalarySlip() { /* å®Ÿè£… */ }
        function downloadQR() { /* å®Ÿè£… */ }
        function printQR() { window.print(); }
    </script>
</body>
</html>
